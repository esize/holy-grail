- name: package managers | cargo | install cargo and rust-related tools
  block:
    - name: package managers | cargo | check if cargo is installed
      command: cargo -V
      register: cargo_exists
      changed_when: false
      ignore_errors: yes

    - name: package managers | cargo | download installer
      get_url:
        url: https://sh.rustup.rs
        dest: /tmp/sh.rustup.rs
        mode: '0755'
      when: cargo_exists.rc != 0

    - name: package managers | cargo | install cargo
      shell: /tmp/sh.rustup.rs -y
      args:
        creates: ~/.cargo/bin/cargo
      when: cargo_exists.rc != 0

    - name: package managers | cargo | source cargo env
      changed_when: false
      shell: source ~/.cargo/env
      args:
        executable: /bin/bash

    - name: package managers | cargo | install packages using cargo
      community.general.cargo:
        name:
          - eza
          - bat
          - zoxide
          - ripgrep
        state: latest
        locked: true
        executable: ~/.cargo/bin/cargo
      environment:
        PATH: "{{ ansible_env.HOME }}/.cargo/bin:{{ ansible_env.PATH }}"
      when: cargo_exists.rc != 0